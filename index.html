<!DOCTYPE html>
<html>
<head>
<title>Horizon City Mentor</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; padding:20px; background:#111; color:#fff; }
button { padding:10px; margin-top:10px; }
textarea { width:100%; height:100px; }
.box { border:1px solid #555; padding:10px; margin-top:15px; white-space:pre-wrap; }
.status { margin-bottom:10px; font-weight:bold; }
</style>
</head>
<body>

<h2>Horizon City Civil Engineering Mentor</h2>

<div class="status" id="status"></div>

<textarea id="notes" placeholder="Upload notes or type proceed"></textarea>
<br>
<button onclick="runSession()">Start Session</button>

<div id="output"></div>

<script>

function initializeApp(){
  if(localStorage.getItem("current_day") === null){
    localStorage.setItem("current_day","1");
  }
  if(localStorage.getItem("current_session") === null){
    localStorage.setItem("current_session","1");
  }
  updateStatus();
}

function updateStatus(){
  const day = localStorage.getItem("current_day") || "1";
  const session = localStorage.getItem("current_session") || "1";
  document.getElementById("status").innerText =
  "Day " + day + " - Session " + session;
}

async function runSession(){
  const day = localStorage.getItem("current_day") || "1";
  const session = localStorage.getItem("current_session") || "1";
  const notes = document.getElementById("notes").value;

  updateStatus();

  const prompt = `
Role: Act as "The Horizon City Civil Engineering Mentor."
Day ${day} â€“ Session ${session}.
Notes: ${notes}
`;

  try{
    const response = await fetch(
      "https://horizon-backend-c1uy.onrender.com/generate",
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ prompt })
      }
    );

    const data = await response.json();

    if(data.error){
      throw new Error("Backend error");
    }

    document.getElementById("output").innerHTML =
      "<div class='box'>" + (data.text || "No response") + "</div>";

  } catch(e){
    document.getElementById("output").innerHTML =
      "<div class='box'>Connection Error.</div>";
  }
}

initializeApp();
</script>

</body>
</html>
