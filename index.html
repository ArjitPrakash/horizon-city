<!DOCTYPE html>
<html>
<head>
<title>Horizon City Mentor</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; padding:20px; background:#111; color:#fff; }
button { padding:10px; margin-top:10px; }
textarea { width:100%; height:100px; }
.box { border:1px solid #555; padding:10px; margin-top:15px; white-space:pre-wrap; }
.status { margin-bottom:10px; font-weight:bold; }
</style>
</head>
<body>

<h2>Horizon City Civil Engineering Mentor</h2>

<div class="status" id="status"></div>

<textarea id="notes" placeholder="Upload notes or type proceed"></textarea>
<br>
<button onclick="runSession()">Start Session</button>

<div id="output"></div>

<script>
const API_KEY = AIzaSyAORydq4j9eeBTLdySOYv4yzIfD8lkErJo;

// Initialize memory safely
function initializeApp(){
  if(!localStorage.getItem("current_day")){
    localStorage.setItem("current_day", "1");
  }
  if(!localStorage.getItem("current_session")){
    localStorage.setItem("current_session", "1");
  }
  updateStatus();
}

function updateStatus(){
  const day = localStorage.getItem("current_day");
  const session = localStorage.getItem("current_session");
  document.getElementById("status").innerText =
  "Day " + day + " - Session " + session;
}

async function runSession(){
  const day = localStorage.getItem("current_day");
  const session = localStorage.getItem("current_session");
  const notes = document.getElementById("notes").value;

  updateStatus();

  const prompt = `
Role: Act as “The Horizon City Civil Engineering Mentor.”

Follow strict SSC JE structure.
Day ${day} – Session ${session}.
Notes provided:
${notes}
`;

  try{
    const response = await fetch(
      "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=" + API_KEY,
      {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
          contents:[{parts:[{text:prompt}]}]
        })
      }
    );

    const data = await response.json();
    const text = data?.candidates?.[0]?.content?.parts?.[0]?.text || "Error generating response.";

    document.getElementById("output").innerHTML =
    "<div class='box'>" + text + "</div>";

  } catch(error){
    document.getElementById("output").innerHTML =
    "<div class='box'>API Error. Check key.</div>";
  }
}

initializeApp();
</script>

</body>
</html>
