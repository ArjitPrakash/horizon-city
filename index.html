<!DOCTYPE html>
<html>
<head>
<title>Horizon City Mentor</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; padding:20px; background:#111; color:#fff; }
button { padding:10px; margin-top:10px; }
textarea { width:100%; height:100px; }
.box { border:1px solid #555; padding:10px; margin-top:15px; white-space:pre-wrap; }
.status { margin-bottom:10px; font-weight:bold; }
</style>
</head>
<body>

<h2>Horizon City Civil Engineering Mentor</h2>

<div class="status" id="status"></div>

<textarea id="notes" placeholder="Upload notes or type proceed"></textarea>
<br>
<button onclick="runSession()">Start Session</button>

<div id="output"></div>

<script>
const API_KEY = "AIzaSyDiB9g3Nki2qTI_ad6sFIseoAg3_v2dH84";

function initializeApp(){
  if(localStorage.getItem("current_day") === null){
    localStorage.setItem("current_day","1");
  }
  if(localStorage.getItem("current_session") === null){
    localStorage.setItem("current_session","1");
  }
  updateStatus();
}

function updateStatus(){
  const day = localStorage.getItem("current_day") || "1";
  const session = localStorage.getItem("current_session") || "1";
  document.getElementById("status").innerText =
  "Day " + day + " - Session " + session;
}

async function runSession(){
  const day = localStorage.getItem("current_day") || "1";
  const session = localStorage.getItem("current_session") || "1";
  const notes = document.getElementById("notes").value;

  updateStatus();

  const prompt = `
Role: Act as "The Horizon City Civil Engineering Mentor."
Day ${day} â€“ Session ${session}.
Notes: ${notes}
`;

  try{
    const response = await fetch(
      "https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=" + API_KEY,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          contents: [
            {
              role: "user",
              parts: [{ text: prompt }]
            }
          ]
        })
      }
    );

    const data = await response.json();

    if(data.error){
      throw new Error(data.error.message);
    }

    const text =
      data.candidates?.[0]?.content?.parts?.map(p => p.text).join("") 
      || "No response from AI.";

    document.getElementById("output").innerHTML =
      "<div class='box'>" + text + "</div>";

  } catch(e){
    document.getElementById("output").innerHTML =
      "<div class='box'>API Error: " + e.message + "</div>";
  }
}

initializeApp();
</script>

</body>
</html>
